{
  "project": "Shindig",
  "description": "Implement custom event fields so hosts can collect additional information from guests beyond the built-in fields. Three field types: text questions (e.g. 'Dietary restrictions?', 'T-shirt size?'), polls (single or multi-select, e.g. 'Which date works?'), and signup lists (e.g. 'Sign up to bring: Salad, Drinks, Dessert' with claim limits). Hosts configure fields when creating/editing an event; guests fill them out during RSVP. Poll results and signup status are visible on the public event page; text responses are private to the host.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Database schema for custom event fields",
      "description": "As a developer, I want database tables for custom field definitions and guest responses, so that the system can store and query custom field data with proper referential integrity.",
      "acceptanceCriteria": [
        "A new migration file exists at supabase/migrations/20260217000000_custom_event_fields.sql",
        "Table event_custom_fields is created with columns: id (uuid PK default gen_random_uuid()), event_id (uuid FK references events on delete cascade), type (text NOT NULL check in ('text','poll','signup')), label (text NOT NULL), description (text), required (boolean default false), sort_order (integer default 0), options (jsonb), config (jsonb default '{}'), created_at (timestamptz default now())",
        "Table custom_field_responses is created with columns: id (uuid PK default gen_random_uuid()), field_id (uuid FK references event_custom_fields on delete cascade), guest_id (uuid FK references guests on delete cascade), value (text), created_at (timestamptz default now()), updated_at (timestamptz default now())",
        "A unique constraint exists on (field_id, guest_id) in custom_field_responses",
        "Indexes exist on event_custom_fields(event_id) and custom_field_responses(field_id) and custom_field_responses(guest_id)",
        "RLS is enabled on both tables: hosts can manage their own event's fields, anyone can read fields for public events, response writes go through admin/service role client",
        "Migration SQL is syntactically valid and can be applied to the Supabase instance"
      ],
      "priority": 1,
      "status": "complete",
      "phase": 1,
      "startedAt": "2026-02-16T20:51:38.220825",
      "actualDuration": 808.1098592281342,
      "iterationNumber": 1
    },
    {
      "id": "US-002",
      "title": "TypeScript types and validation for custom fields",
      "description": "As a developer, I want TypeScript types and validation functions for custom fields and responses, so that field data is type-safe and validated before database writes.",
      "acceptanceCriteria": [
        "src/lib/types.ts exports CustomFieldType ('text' | 'poll' | 'signup'), CustomField interface, and CustomFieldResponse interface matching the database schema",
        "CustomField interface includes: id, event_id, type, label, description (string | null), required, sort_order, options (string[] | null), config ({ multi_select?: boolean; max_claims_per_item?: number }), created_at",
        "CustomFieldResponse interface includes: id, field_id, guest_id, value (string | null), created_at, updated_at",
        "src/lib/validation.ts exports validateCustomFields(fields) that enforces: max 10 fields per event, label required (1-200 chars), poll/signup fields need 2-20 options, no duplicate options within a field, type must be 'text', 'poll', or 'signup'",
        "src/lib/validation.ts exports validateCustomResponses(responses, fields) that enforces: required fields must have a non-empty value, text values max 1000 chars, poll/signup values must be valid options from the field definition",
        "Both validation functions return { valid: boolean; errors: string[] }",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 1,
      "status": "complete",
      "phase": 1,
      "startedAt": "2026-02-16T21:05:26.384667",
      "actualDuration": 336.626403093338,
      "iterationNumber": 2
    },
    {
      "id": "US-003",
      "title": "Event creation and edit API accepts custom fields",
      "description": "As an event host, I want to save custom field definitions when creating or editing an event, so that my fields are persisted and available for guest responses.",
      "acceptanceCriteria": [
        "POST /api/events accepts an optional custom_fields array in the request body, each with type, label, description, required, sort_order, options, and config",
        "After event creation, custom fields are inserted into event_custom_fields with the new event's ID",
        "PUT /api/events/manage/[id] accepts an optional custom_fields array in the request body",
        "On update: fields with an existing id are updated, fields without an id are inserted as new, fields that were previously saved but are missing from the array are deleted (cascade deletes their responses)",
        "Custom fields are validated using validateCustomFields before saving \u2014 invalid fields return 400 with error details",
        "GET /api/events/manage/[id] returns the event's custom fields in the response",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 1,
      "status": "complete",
      "phase": 1,
      "startedAt": "2026-02-16T21:11:31.358119",
      "actualDuration": 1769.6382541656494,
      "iterationNumber": 3
    },
    {
      "id": "US-004",
      "title": "RSVP API returns and accepts custom field data",
      "description": "As a guest, I want to see and respond to custom fields when RSVPing, so that I can provide the host with the information they need.",
      "acceptanceCriteria": [
        "GET /api/rsvp/[token] returns custom_fields (event_custom_fields ordered by sort_order) and custom_responses (this guest's responses) in the response",
        "For signup-type fields, GET also returns signup_claims: an object keyed by field_id with claim counts per option aggregated across all guests",
        "POST /api/rsvp/[token] accepts an optional custom_responses array of { field_id, value } objects in the request body",
        "Responses are validated using validateCustomResponses against the field definitions before saving",
        "For signup fields, the API checks current claim counts before upserting and rejects if max_claims_per_item would be exceeded (small race window acceptable for MVP)",
        "Responses are upserted using ON CONFLICT (field_id, guest_id) DO UPDATE to allow guests to change their answers",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 1,
      "status": "complete",
      "phase": 1,
      "startedAt": "2026-02-16T22:42:20.425220",
      "actualDuration": 1342.6531581878662,
      "iterationNumber": 5
    },
    {
      "id": "US-005",
      "title": "CustomFieldBuilder component for event creation form",
      "description": "As an event host, I want to add, configure, reorder, and remove custom fields when creating or editing my event, so that I can collect the exact information I need from guests.",
      "acceptanceCriteria": [
        "A new component CustomFieldBuilder exists at src/components/CustomFieldBuilder.tsx",
        "It is rendered in EventForm (src/components/EventForm.tsx) as a collapsible 'Custom Questions' section between the existing form sections and the Submit button",
        "An 'Add a question' button opens a type picker with three options: Text Question, Poll, and Signup List",
        "Each field is rendered as a card with: label input, optional description input, required toggle checkbox",
        "Poll fields additionally show: an editable option list with add/remove buttons, and an 'Allow multiple selections' checkbox",
        "Signup fields additionally show: an editable item list with add/remove buttons, and a 'Max signups per item' number input",
        "Up/down arrow buttons allow reordering fields (no drag-and-drop library needed)",
        "A delete button removes a field from the list",
        "Maximum 10 fields enforced \u2014 the 'Add a question' button is disabled when limit is reached",
        "The component's state (array of field objects) is lifted to EventForm and included in the submit payload",
        "In edit mode, existing custom fields are loaded and pre-populated in the builder",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 2,
      "status": "complete",
      "phase": 2,
      "startedAt": "2026-02-16T23:05:08.336129",
      "actualDuration": 1071.8253710269928,
      "iterationNumber": 6
    },
    {
      "id": "US-006",
      "title": "RSVP form renders custom field inputs",
      "description": "As a guest responding to an event, I want to see and fill out the host's custom questions in the RSVP form, so that I can provide the requested information alongside my attendance status.",
      "acceptanceCriteria": [
        "A new component CustomFieldInput exists at src/components/CustomFieldInput.tsx that renders the appropriate input for each field type",
        "Text fields render as a labeled text input (or textarea for longer answers)",
        "Single-select poll fields render as radio buttons with the poll options",
        "Multi-select poll fields render as checkboxes with the poll options",
        "Signup fields render as checkboxes with claim counts displayed (e.g. 'Salad - 2/3 claimed'); fully claimed items are disabled",
        "Custom field inputs are only shown when the guest's status is 'going' or 'maybe' (not 'not_going')",
        "RSVPForm (src/components/RSVPForm.tsx) receives custom fields, responses, and signup claims as props and renders CustomFieldInput for each field",
        "The RSVP page at src/app/rsvp/[token]/page.tsx fetches custom fields, responses, and claims from the API and passes them to RSVPForm",
        "Required fields are marked with an asterisk and validated before submission",
        "Custom responses are included in the POST /api/rsvp/[token] payload on submit",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 2,
      "status": "complete",
      "phase": 2,
      "startedAt": "2026-02-16T23:23:23.397099",
      "actualDuration": 410.21831583976746,
      "iterationNumber": 7
    },
    {
      "id": "US-007",
      "title": "Dashboard shows custom field results",
      "description": "As an event host, I want to see aggregated results for all custom fields on my event dashboard, so that I can review guest responses and plan accordingly.",
      "acceptanceCriteria": [
        "A new component CustomFieldResults exists at src/components/CustomFieldResults.tsx",
        "It is rendered on the dashboard event detail page at src/app/dashboard/[id]/page.tsx below the guest list section",
        "Text field results are shown as a table with columns: Guest Name, Response",
        "Poll field results are shown as horizontal progress bars with vote distribution (option name, count, percentage)",
        "Signup field results are shown as a table with columns: Item, Claimed By (list of guest names), Spots Left",
        "The dashboard page fetches all custom field definitions and all guest responses for the event",
        "Empty fields (no responses yet) show a placeholder message",
        "If the event has no custom fields, the section is not rendered",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 2,
      "status": "complete",
      "phase": 2,
      "startedAt": "2026-02-16T23:30:22.944163",
      "actualDuration": 445.95147919654846,
      "iterationNumber": 8
    },
    {
      "id": "US-008",
      "title": "Public event page shows poll results and signup status",
      "description": "As a visitor viewing a public event page, I want to see poll result summaries and signup list status, so that I can see what others have voted for and what signup spots are available.",
      "acceptanceCriteria": [
        "A new API endpoint exists at src/app/api/events/[slug]/custom-fields/route.ts that returns aggregated poll results and signup claim status for a public event",
        "The endpoint does NOT return text field responses (those are private to the host)",
        "A new component PublicCustomFields exists at src/components/PublicCustomFields.tsx",
        "It is rendered on the public event page at src/app/e/[slug]/page.tsx between the description and gift/registry section",
        "Poll results show vote distribution as progress bars or simple counts",
        "Signup status shows each item with claimed count vs total spots available",
        "If the event has no poll or signup fields, the component renders nothing",
        "TypeScript typecheck passes with no errors (npm run build)"
      ],
      "priority": 3,
      "status": "complete",
      "phase": 3,
      "startedAt": "2026-02-16T23:37:57.608745",
      "actualDuration": 292.2012782096863,
      "iterationNumber": 9
    },
    {
      "id": "US-009",
      "title": "E2E tests for custom event fields",
      "description": "As a developer, I want comprehensive E2E tests for the custom fields feature, so that regressions are caught automatically.",
      "acceptanceCriteria": [
        "A new test file exists at e2e/custom-fields.spec.ts",
        "Test helpers in e2e/helpers.ts include seedCustomField(eventId, overrides?) and seedCustomFieldResponse(fieldId, guestId, value) functions",
        "cleanupTestData() in e2e/helpers.ts also cleans up event_custom_fields and custom_field_responses test data",
        "Test: Host can add text, poll, and signup fields during event creation and they are saved",
        "Test: Custom fields appear on the RSVP form for guests with going/maybe status",
        "Test: Guest can submit responses for all three field types",
        "Test: Signup claim limits are enforced (fully claimed items are disabled)",
        "Test: Host sees custom field results on the dashboard (text table, poll bars, signup table)",
        "Test: Poll results and signup status are visible on the public event page",
        "Test: Custom fields are editable and removable when editing an existing event",
        "All E2E tests pass (npm test)"
      ],
      "priority": 3,
      "status": "in_progress",
      "phase": 3,
      "startedAt": "2026-02-16T23:42:57.952538"
    }
  ],
  "branchName": "main",
  "phases": {
    "1": {
      "name": "Phase 1",
      "description": ""
    }
  },
  "metadata": {
    "createdAt": "2026-02-17T01:51:22.278Z",
    "lastUpdatedAt": "2026-02-16T23:42:57.952550",
    "totalStories": 9,
    "completedStories": 8,
    "currentIteration": 9
  }
}